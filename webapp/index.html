<!doctype html>
<html lang="el">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>VeoLumi â€“ Î ÏÎ¿Ï†Î¯Î»</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;background:#0e0f12;color:#fff}
    .wrap{max-width:520px;margin:0 auto;padding:16px}
    .card{background:#171a20;border:1px solid #232734;border-radius:16px;padding:14px;margin-bottom:14px}
    .row{display:flex;align-items:center;justify-content:space-between;gap:12px}
    .avatar{width:44px;height:44px;border-radius:50%;background:#2a2f3d;display:flex;align-items:center;justify-content:center;overflow:hidden}
    .avatar img{width:100%;height:100%;object-fit:cover}
    .muted{color:#9aa3b2}
    .big{font-size:26px;font-weight:800}
    .btn{width:100%;padding:12px 14px;border-radius:14px;border:0;background:#2a2f3d;color:#fff;font-weight:700}
    .btn.primary{background:#6f3cff}
    .plans{display:flex;overflow:auto;gap:12px;padding-bottom:8px}
    .plan{min-width:260px}
    .pill{display:inline-block;background:#2a2f3d;border:1px solid #343a4a;border-radius:10px;padding:6px 10px;font-weight:700}
    .check{color:#a78bfa}
    ul{margin:10px 0 0 18px;padding:0}
    li{margin:6px 0}
    .title{font-weight:800;font-size:18px}
    .sp{height:8px}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <div class="row">
        <div class="row" style="justify-content:flex-start">
          <div class="avatar" id="avatar"><span>ğŸ‘¤</span></div>
          <div>
            <div id="name" class="title">â€”</div>
            <div id="plan" class="muted">Î¤ÏÎ­Ï‡Î¿Î½ Ï€Î±ÎºÎ­Ï„Î¿: â€”</div>
          </div>
        </div>
        <div style="text-align:right">
          <div class="muted">Î¥Ï€ÏŒÎ»Î¿Î¹Ï€Î¿ credits</div>
          <div id="credits" class="big">â€”</div>
        </div>
      </div>
    </div>

    <div class="card">
      <div class="muted">Î¤ÏÎ­Ï‡Î¿Î½ Ï€Î±ÎºÎ­Ï„Î¿</div>
      <div id="planBig" class="big" style="font-size:22px;margin:6px 0 10px">Free</div>
      <button class="btn" id="buyMore">Î‘Î³Î¿ÏÎ¬ ÎµÏ€Î¹Ï€Î»Î­Î¿Î½ credits</button>
    </div>

    <div class="card">
      <div class="title">Î£Ï…Î½Î´ÏÎ¿Î¼Î­Ï‚</div>
      <div class="sp"></div>

      <div class="plans" id="plans"></div>
    </div>

    <div class="card">
      <div class="title">Î ÏÏŒÎ³ÏÎ±Î¼Î¼Î± ÏƒÏ…Î½ÎµÏÎ³Î±Ï„ÏÎ½</div>
      <div class="muted">ÎšÎ­ÏÎ´Î¹ÏƒÎµ % Î±Ï€ÏŒ Ï„Î¹Ï‚ Î±Î³Î¿ÏÎ­Ï‚ Ï€Î¿Ï… Ï†Î­ÏÎ½ÎµÎ¹Ï‚.</div>
      <div class="sp"></div>
      <div class="pill" id="ref">Î¦ÏŒÏÏ„Ï‰ÏƒÎ·â€¦</div>
      <div class="sp"></div>
      <button class="btn" id="copyRef">Î‘Î½Ï„Î¹Î³ÏÎ±Ï†Î® link</button>
    </div>
  </div>

<script>
  const tg = window.Telegram?.WebApp;
  if (tg) tg.expand();

  const PLANS = [
    {code:"FREE", name:"Free", credits:5,  price:"Î”Ï‰ÏÎµÎ¬Î½", perks:["Î”Î¿ÎºÎ¹Î¼Î® ÎµÏÎ³Î±Î»ÎµÎ¯Ï‰Î½ ÎµÎ¹ÎºÏŒÎ½Î±Ï‚", "Nano Banana / Flux / Midjourney"]},
    {code:"START", name:"Start", credits:100, price:"7,5$", perks:["Î ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÎµ ÏŒÎ»Î± Ï„Î± ÎµÏÎ³Î±Î»ÎµÎ¯Î±", "5% Ï€ÏÎ¿Î¼Î®Î¸ÎµÎ¹Î± ÏƒÏ…Î½ÎµÏÎ³Î±Ï„ÏÎ½"]},
    {code:"MIDDLE", name:"Middle", credits:250, price:"14$", perks:["Î ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÎµ ÏŒÎ»Î± Ï„Î± ÎµÏÎ³Î±Î»ÎµÎ¯Î±", "10% Ï€ÏÎ¿Î¼Î®Î¸ÎµÎ¹Î± ÏƒÏ…Î½ÎµÏÎ³Î±Ï„ÏÎ½"]},
    {code:"PRO", name:"Pro", credits:500, price:"32$", perks:["Î ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÎµ ÏŒÎ»Î± Ï„Î± ÎµÏÎ³Î±Î»ÎµÎ¯Î±", "15% Ï€ÏÎ¿Î¼Î®Î¸ÎµÎ¹Î± ÏƒÏ…Î½ÎµÏÎ³Î±Ï„ÏÎ½"]},
    {code:"CREATOR", name:"Creator", credits:1000, price:"57$", perks:["Î ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÎµ ÏŒÎ»Î± Ï„Î± ÎµÏÎ³Î±Î»ÎµÎ¯Î±", "20% Ï€ÏÎ¿Î¼Î®Î¸ÎµÎ¹Î± ÏƒÏ…Î½ÎµÏÎ³Î±Ï„ÏÎ½"]},
    {code:"ULTRA", name:"Ultra Pro", credits:2000, price:"95$", perks:["Î ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÎµ ÏŒÎ»Î± Ï„Î± ÎµÏÎ³Î±Î»ÎµÎ¯Î±", "Veo / Sora / Nano (Unlimited*)", "30% Ï€ÏÎ¿Î¼Î®Î¸ÎµÎ¹Î± ÏƒÏ…Î½ÎµÏÎ³Î±Ï„ÏÎ½"]},
  ];

  function renderPlans(){
    const root = document.getElementById("plans");
    root.innerHTML = "";
    PLANS.forEach(p=>{
      const el = document.createElement("div");
      el.className = "card plan";
      el.innerHTML = `
        <div class="row">
          <div>
            <div class="title">${p.name}</div>
            <div class="muted">Credits: ${p.credits}</div>
          </div>
          <div class="pill">${p.price}</div>
        </div>
        <ul>
          ${p.perks.map(x=>`<li><span class="check">âœ“</span> ${x}</li>`).join("")}
        </ul>
        <div class="sp"></div>
        <button class="btn primary" data-plan="${p.code}">Î‘Î³Î¿ÏÎ¬</button>
      `;
      root.appendChild(el);
    });

    root.querySelectorAll("button[data-plan]").forEach(btn=>{
      btn.addEventListener("click", async ()=>{
        const plan = btn.getAttribute("data-plan");
        // Î£Ï„Î­Î»Î½Î¿Ï…Î¼Îµ event ÏƒÏ„Î¿ bot (Î¸Î± Ï„Î¿ Ï€Î¹Î¬ÏƒÎµÎ¹ backend)
        if (tg) {
          tg.sendData(JSON.stringify({action:"buy_plan", plan}));
        } else {
          alert("Telegram WebApp Î´ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎµ.");
        }
      });
    });
  }

  async function loadProfile(){
    // Ï€Î±Î¯ÏÎ½Î¿Ï…Î¼Îµ initData Î±Ï€ÏŒ Telegram Î³Î¹Î± verify ÏƒÏ„Î¿ backend
    const initData = tg?.initData || "";
    const res = await fetch("/api/me", {
      method:"POST",
      headers: {"Content-Type":"application/json"},
      body: JSON.stringify({ initData })
    });
    const data = await res.json();

    document.getElementById("name").textContent = data.name || "â€”";
    document.getElementById("credits").textContent = data.credits ?? "â€”";
    document.getElementById("plan").textContent = "Î¤ÏÎ­Ï‡Î¿Î½ Ï€Î±ÎºÎ­Ï„Î¿: " + (data.plan || "Free");
    document.getElementById("planBig").textContent = data.plan || "Free";

    if (data.photo_url){
      const av = document.getElementById("avatar");
      av.innerHTML = `<img src="${data.photo_url}" />`;
    }

    document.getElementById("ref").textContent = data.referral_link || "â€”";

    document.getElementById("copyRef").onclick = async ()=>{
      await navigator.clipboard.writeText(data.referral_link || "");
      if (tg) tg.showPopup({title:"ÎˆÏ„Î¿Î¹Î¼Î¿", message:"Î¤Î¿ link Î±Î½Ï„Î¹Î³ÏÎ¬Ï†Î·ÎºÎµ.", buttons:[{type:"ok"}]});
      else alert("Î‘Î½Ï„Î¹Î³ÏÎ¬Ï†Î·ÎºÎµ.");
    };

    document.getElementById("buyMore").onclick = ()=>{
      if (tg) tg.showPopup({title:"Î‘Î³Î¿ÏÎ¬ credits", message:"Î”Î¹Î¬Î»ÎµÎ¾Îµ Ï€Î±ÎºÎ­Ï„Î¿ Î±Ï€ÏŒ Ï„Î¹Ï‚ Î£Ï…Î½Î´ÏÎ¿Î¼Î­Ï‚ Ï€Î±ÏÎ±ÎºÎ¬Ï„Ï‰.", buttons:[{type:"ok"}]});
    };
  }

  renderPlans();
  loadProfile().catch(e=>console.error(e));
</script>
</body>
</html>
