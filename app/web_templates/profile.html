<!-- app/web_templates/profile.html -->
<!doctype html>
<html lang="el">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>VeoLumi – Προφίλ</title>

  <!-- Telegram WebApp SDK -->
  <script src="https://telegram.org/js/telegram-web-app.js"></script>

  <style>
    :root{
      --bg:#0e0f12;
      --card:#171a20;
      --card2:#141820;
      --border:#232734;
      --muted:#9aa3b2;
      --text:#ffffff;
      --purple:#7c3aed;
      --purple2:#6d28d9;
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --radius:18px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;
      background:var(--bg);
      color:var(--text);
    }
    .wrap{max-width:540px;margin:0 auto;padding:14px 14px 80px}
    .card{
      background:linear-gradient(180deg, rgba(255,255,255,.02), rgba(255,255,255,0)) , var(--card);
      border:1px solid var(--border);
      border-radius:var(--radius);
      padding:14px;
      margin-bottom:14px;
      box-shadow:var(--shadow);
    }
    .row{display:flex;align-items:center;justify-content:space-between;gap:12px}
    .muted{color:var(--muted)}
    .h1{font-size:18px;font-weight:800;margin:0}
    .h2{font-size:16px;font-weight:800;margin:0 0 10px 0}
    .btn{
      display:inline-flex;align-items:center;justify-content:center;
      padding:12px 14px;border-radius:14px;border:1px solid var(--border);
      background:rgba(255,255,255,.03);
      color:var(--text);
      font-weight:800;
      cursor:pointer;
      width:100%;
      transition:.15s transform, .15s opacity, .15s background;
      user-select:none;
    }
    .btn:active{transform:scale(.99)}
    .btn.primary{
      background:linear-gradient(180deg,var(--purple),var(--purple2));
      border-color:rgba(255,255,255,.08);
    }
    .btn.disabled{opacity:.55;cursor:not-allowed}
    .pill{
      display:inline-flex;align-items:center;gap:8px;
      padding:8px 10px;border-radius:12px;
      border:1px solid var(--border);
      background:rgba(255,255,255,.03);
      font-weight:800;
      white-space:nowrap;
    }
    .avatar{
      width:54px;height:54px;border-radius:50%;
      background:#2a2f3d;
      border:1px solid rgba(255,255,255,.06);
      display:flex;align-items:center;justify-content:center;
      overflow:hidden;flex:0 0 auto;
    }
    .avatar img{width:100%;height:100%;object-fit:cover;display:none}
    .avatar span{font-size:18px;font-weight:950;color:#cfd3df}
    .balance{
      text-align:right;
      display:flex;flex-direction:column;gap:2px;
    }
    .balance .num{font-size:22px;font-weight:950}
    .section-title{
      margin:14px 0 10px 0;
      color:#cfd3df;font-weight:900;letter-spacing:.2px;
    }

    /* Horizontal plan slider */
    .plans{
      display:flex;gap:12px;overflow:auto;padding-bottom:6px;
      scroll-snap-type:x mandatory;
    }
    .plan{
      min-width:290px;
      scroll-snap-align:start;
      background:linear-gradient(180deg, rgba(124,58,237,.12), rgba(255,255,255,0)) , var(--card2);
      border:1px solid var(--border);
      border-radius:22px;
      padding:14px;
      position:relative;
    }
    .plan .name{font-size:20px;font-weight:950;margin:0 0 6px 0}
    .plan .credits{font-weight:900;color:#cfd3df;margin-bottom:8px}
    .tags{display:flex;gap:8px;margin-bottom:10px;flex-wrap:wrap}
    .tag{
      padding:7px 10px;border-radius:12px;
      border:1px solid var(--border);
      background:rgba(255,255,255,.03);
      font-weight:900;
    }
    .checks{margin:10px 0 12px 0;display:flex;flex-direction:column;gap:8px}
    .check{
      display:flex;gap:10px;align-items:flex-start;
      color:#d8deea;
    }
    .check .dot{
      width:18px;height:18px;border-radius:7px;
      background:rgba(124,58,237,.18);
      border:1px solid rgba(124,58,237,.35);
      display:flex;align-items:center;justify-content:center;
      flex:0 0 auto;
      margin-top:1px;
    }
    .check .dot::after{content:"✓";font-weight:950;color:#bda8ff;font-size:12px}
    .plan .btn{margin-top:10px}
    .plan .btn.secondary{
      background:rgba(255,255,255,.03);
      border-color:var(--border);
      font-weight:900;
    }

    /* Bottom tabs */
    .tabs{
      position:fixed;left:0;right:0;bottom:0;
      background:rgba(14,15,18,.88);
      backdrop-filter: blur(10px);
      border-top:1px solid rgba(255,255,255,.06);
      padding:10px 14px;
    }
    .tabs-inner{
      max-width:540px;margin:0 auto;
      display:flex;gap:10px;
    }
    .tab{
      flex:1;
      border:1px solid rgba(255,255,255,.06);
      background:rgba(255,255,255,.03);
      color:#cfd3df;
      padding:10px 12px;
      border-radius:16px;
      font-weight:900;
      text-align:center;
      cursor:pointer;
      user-select:none;
    }
    .tab.active{
      background:rgba(124,58,237,.18);
      border-color:rgba(124,58,237,.35);
      color:#ffffff;
    }

    /* Modal */
    .modal-backdrop{
      position:fixed;inset:0;
      background:rgba(0,0,0,.55);
      display:none;
      align-items:center;
      justify-content:center;
      padding:18px;
      z-index:50;
    }
    .modal{
      width:min(520px, 100%);
      background:var(--card);
      border:1px solid var(--border);
      border-radius:22px;
      box-shadow:var(--shadow);
      overflow:hidden;
    }
    .modal-head{
      display:flex;align-items:center;justify-content:space-between;
      padding:14px 14px 10px 14px;
      border-bottom:1px solid rgba(255,255,255,.06);
    }
    .modal-title{font-weight:950}
    .x{
      width:34px;height:34px;border-radius:12px;
      border:1px solid rgba(255,255,255,.08);
      background:rgba(255,255,255,.03);
      color:#fff;
      font-weight:950;
      cursor:pointer;
    }
    .modal-body{padding:14px}
    .input{
      width:100%;
      padding:12px 12px;
      border-radius:14px;
      border:1px solid var(--border);
      background:rgba(255,255,255,.03);
      color:#fff;
      outline:none;
    }
    .grid{
      display:grid;
      grid-template-columns:repeat(4,1fr);
      gap:10px;
      margin-top:10px;
    }
    .opt{
      padding:12px 10px;
      border-radius:14px;
      border:1px solid var(--border);
      background:rgba(255,255,255,.03);
      text-align:center;
      font-weight:950;
      cursor:pointer;
      user-select:none;
    }
    .opt.active{
      background:rgba(124,58,237,.18);
      border-color:rgba(124,58,237,.35);
    }
    .select{
      width:100%;
      padding:12px 12px;
      border-radius:14px;
      border:1px solid var(--border);
      background:rgba(255,255,255,.03);
      color:#fff;
      outline:none;
      margin-top:10px;
      font-weight:900;
    }
    .price-line{
      margin-top:10px;
      display:flex;align-items:center;justify-content:space-between;
      color:#cfd3df;
      font-weight:900;
    }
    .price-line .price{
      font-size:18px;font-weight:950;color:#fff;
    }

    /* Tools modal list */
    .tools-box{
      background:rgba(255,255,255,.03);
      border:1px solid rgba(255,255,255,.06);
      border-radius:18px;
      padding:12px;
    }
    .tools-head{
      display:flex;align-items:center;justify-content:space-between;
      font-weight:950;color:#cfd3df;margin-bottom:10px;
    }
    .tool{
      display:flex;align-items:center;justify-content:space-between;
      padding:9px 10px;border-radius:14px;
      border:1px solid rgba(255,255,255,.06);
      background:rgba(0,0,0,.12);
      margin-bottom:8px;
      gap:10px;
    }
    .tool:last-child{margin-bottom:0}
    .tool .nm{font-weight:950}
    .tool .c{color:#cfd3df;font-weight:900}

    /* Hide sections per tab */
    .page{display:none}
    .page.active{display:block}
  </style>
</head>

<body>
  <div class="wrap">

    <!-- Header card -->
    <div class="card">
      <div class="row">
        <div class="row" style="gap:12px">
          <div class="avatar">
            <span id="avatar-fallback">?</span>
            <img id="avatar" alt="avatar" />
          </div>
          <div>
            <div id="name" class="h1">—</div>
            <div class="muted" style="font-weight:800;margin-top:2px">Ο λογαριασμός σου</div>
          </div>
        </div>

        <div class="balance">
          <div class="muted" style="font-weight:900">Υπόλοιπο credits</div>
          <div class="num" id="credits">—</div>
        </div>
      </div>
    </div>

    <!-- CURRENT PLAN + extra credits button -->
    <div class="card">
      <div class="muted" style="font-weight:900;margin-bottom:6px">Τρέχον πακέτο</div>
      <div class="h1" style="font-size:22px">Δωρεάν</div>

      <div style="height:10px"></div>

      <button class="btn" id="btnExtraCredits">Αγορά επιπλέον credits</button>
    </div>

    <!-- PROFILE PAGE -->
    <div id="page-profile" class="page active">
      <div class="section-title">Συνδρομές</div>
      <div class="plans" id="plans"></div>
    </div>

    <!-- PARTNERS PAGE (placeholder like your screenshots) -->
    <div id="page-partners" class="page">
      <div class="card">
        <div style="font-weight:950;font-size:16px;margin-bottom:10px">
          Στείλε στους φίλους σου το μοναδικό σου link και κέρδιζε μαζί με το VeoLumi.
        </div>

        <div style="display:flex;gap:10px">
          <button class="btn primary" style="flex:1">Δημιουργία link</button>
          <button class="btn" style="flex:1" id="btnPartnerBenefits">Προνόμια</button>
        </div>
      </div>

      <div class="card">
        <div class="row" style="margin-bottom:10px">
          <div class="h2" style="margin:0">Τα referral links μου</div>
          <div class="muted" style="font-weight:900">0/10</div>
        </div>

        <div style="border:1px solid rgba(255,255,255,.06);border-radius:18px;padding:12px;background:rgba(255,255,255,.03)">
          <div class="muted" style="font-weight:900;margin-bottom:8px">URL</div>
          <div style="font-weight:900;word-break:break-all">—</div>
          <div style="height:10px"></div>
          <div class="row" style="gap:10px">
            <div style="flex:1;border:1px solid rgba(255,255,255,.06);border-radius:16px;padding:10px;background:rgba(0,0,0,.12)">
              <div class="muted" style="font-weight:900">Προσκληθέντες</div>
              <div style="font-weight:950;font-size:18px">0</div>
            </div>
            <div style="flex:1;border:1px solid rgba(255,255,255,.06);border-radius:16px;padding:10px;background:rgba(0,0,0,.12)">
              <div class="muted" style="font-weight:900">Αγορές credits</div>
              <div style="font-weight:950;font-size:18px">0</div>
            </div>
          </div>

          <div style="height:12px"></div>
          <button class="btn">Αντιγραφή link</button>
        </div>
      </div>
    </div>

  </div>

  <!-- Bottom tabs -->
  <div class="tabs">
    <div class="tabs-inner">
      <div class="tab active" id="tabProfile">Το προφίλ μου</div>
      <div class="tab" id="tabPartners">Συνεργασία</div>
    </div>
  </div>

  <!-- Modal: Extra credits purchase -->
  <div class="modal-backdrop" id="modalExtra">
    <div class="modal">
      <div class="modal-head">
        <div class="modal-title">Αγορά επιπλέον credits</div>
        <button class="x" id="closeExtra">✕</button>
      </div>
      <div class="modal-body">
        <div class="muted" style="font-weight:900;margin-bottom:8px">E-mail για απόδειξη/επικοινωνία</div>
        <input class="input" id="email" placeholder="you@example.com" />

        <div style="height:14px"></div>
        <div class="muted" style="font-weight:900;margin-bottom:8px">Πακέτο credits</div>

        <div class="grid" id="extraPacks"></div>

        <div style="height:14px"></div>
        <div class="muted" style="font-weight:900;margin-bottom:8px">Τρόπος πληρωμής</div>

        <select class="select" id="payMethod">
          <option value="card">Κάρτα VISA/Mastercard</option>
          <option value="stripe">Stripe</option>
          <option value="paypal">PayPal</option>
          <option value="crypto">Κρυπτονόμισμα (Bitcoin/Ethereum)</option>
        </select>

        <div class="price-line">
          <div>Σύνολο</div>
          <div class="price" id="totalPrice">— €</div>
        </div>

        <div style="height:12px"></div>
        <button class="btn primary" id="btnBuyExtra">Αγορά</button>

        <div class="muted" style="margin-top:10px;font-weight:800">
          * Προς το παρόν αυτό είναι UI. Θα συνδέσουμε Stripe/PayPal/Crypto μετά.
        </div>
      </div>
    </div>
  </div>

  <!-- Modal: Tools in plan -->
  <div class="modal-backdrop" id="modalTools">
    <div class="modal">
      <div class="modal-head">
        <div class="modal-title">Τι περιλαμβάνει το πακέτο</div>
        <button class="x" id="closeTools">✕</button>
      </div>
      <div class="modal-body">
        <div class="tools-box">
          <div class="tools-head">
            <div>Βίντεο</div>
            <div class="muted">κόστος (credits)</div>
          </div>

          <div class="tool"><div class="nm">Kling 2.6 Motion</div><div class="c">20–75</div></div>
          <div class="tool"><div class="nm">Kling 01</div><div class="c">15–25</div></div>
          <div class="tool"><div class="nm">Kling V1 Avatar</div><div class="c">16–32</div></div>
          <div class="tool"><div class="nm">Kling 2.6</div><div class="c">11–44</div></div>
          <div class="tool"><div class="nm">Kling 2.1</div><div class="c">5–64</div></div>
          <div class="tool"><div class="nm">Sora 2 PRO</div><div class="c">18–60</div></div>
          <div class="tool"><div class="nm">Veo 3.1</div><div class="c">12</div></div>
          <div class="tool"><div class="nm">Sora 2</div><div class="c">6</div></div>
          <div class="tool"><div class="nm">Veo 3</div><div class="c">10</div></div>
          <div class="tool"><div class="nm">Midjourney</div><div class="c">2–13</div></div>
          <div class="tool"><div class="nm">Runway Aleph</div><div class="c">22</div></div>
          <div class="tool"><div class="nm">Runway</div><div class="c">6</div></div>
          <div class="tool"><div class="nm">Seedance</div><div class="c">1–20</div></div>
          <div class="tool"><div class="nm">Kling 2.5 Turbo</div><div class="c">8–17</div></div>
          <div class="tool"><div class="nm">Wan 2.5</div><div class="c">12–30</div></div>
          <div class="tool"><div class="nm">Hailuo 02</div><div class="c">6–12</div></div>

          <div style="height:12px;border-top:1px solid rgba(255,255,255,.06);margin:12px 0"></div>

          <div class="tools-head">
            <div>Φωτο</div>
            <div class="muted">κόστος (credits)</div>
          </div>
          <div class="tool"><div class="nm">Flux</div><div class="c">—</div></div>
          <div class="tool"><div class="nm">Midjourney (Image)</div><div class="c">—</div></div>
          <div class="tool"><div class="nm">Nano Banana</div><div class="c">—</div></div>

          <div class="muted" style="margin-top:10px;font-weight:800">
            * Θα βάλουμε ακριβή κόστη ανά εργαλείο μόλις κλειδώσουμε τιμοκατάλογο.
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal: Partner benefits -->
  <div class="modal-backdrop" id="modalBenefits">
    <div class="modal">
      <div class="modal-head">
        <div class="modal-title">Προνόμια συνεργασίας</div>
        <button class="x" id="closeBenefits">✕</button>
      </div>
      <div class="modal-body">
        <div class="check"><div class="dot"></div><div>Μπόνους για κάθε νέο χρήστη που ξεκινάει από το link σου.</div></div>
        <div class="check"><div class="dot"></div><div>Ποσοστό από κάθε αγορά credits των χρηστών σου, για πάντα.</div></div>
        <div class="check"><div class="dot"></div><div>Παρακολούθηση σε πραγματικό χρόνο & ειδοποιήσεις.</div></div>
        <div class="check"><div class="dot"></div><div>Ανάληψη κερδών μέσω διαχειριστή.</div></div>
      </div>
    </div>
  </div>

  <script>
    // Helpers
    const $ = (id) => document.getElementById(id);

    // Telegram WebApp init
    const tg = window.Telegram?.WebApp;
    if (tg) {
      tg.expand();
      tg.ready();
    }

    // ---- Data (UI only) ----
    const EXTRA_PACKS = [
      { credits: 100,  price: 7.00 },
      { credits: 250,  price: 12.00 },
      { credits: 500,  price: 22.00 },
      { credits: 1000, price: 40.00 },
    ];

    const SUBSCRIPTIONS = [
      {
        name: "Δωρεάν",
        credits: 5,
        price: 0.00,
        features: [
          "Μπορείς να δοκιμάσεις εργαλεία εικόνας",
          "Nano Banana, Midjourney, Flux κ.ά."
        ],
      },
      {
        name: "Start",
        credits: 100,
        price: 7.00,
        features: [
          "Πρόσβαση σε εργαλεία AI",
          "Υποστήριξη βασικού επιπέδου"
        ],
      },
      {
        name: "Middle",
        credits: 250,
        price: 12.00,
        features: [
          "Πρόσβαση σε εργαλεία AI",
          "Προτεραιότητα στην ουρά"
        ],
      },
      {
        name: "Pro",
        credits: 500,
        price: 22.00,
        features: [
          "Πρόσβαση σε εργαλεία AI",
          "Καλύτερη προτεραιότητα"
        ],
      },
      {
        name: "Creator",
        credits: 1000,
        price: 40.00,
        features: [
          "Πρόσβαση σε όλα",
          "Premium προτεραιότητα"
        ],
      },
    ];

    // ---- API calls ----
    async function apiPost(path, body) {
      const res = await fetch(path, {
        method: "POST",
        headers: {"Content-Type":"application/json"},
        body: JSON.stringify(body || {})
      });
      return await res.json();
    }

    async function loadMe() {
      const initData = tg?.initData || "";
      const me = await apiPost("/api/me", { initData });

      if (!me.ok) return;

      const u = me.user || {};
      const displayName = (u.first_name || u.username || String(u.id || "Χρήστης"));
      $("name").innerText = displayName;

      // credits
      $("credits").innerText = String(Math.floor(u.credits || 0));

      // avatar fallback letter
      const letter = (displayName || "U").toString().trim()[0]?.toUpperCase() || "U";
      $("avatar-fallback").innerText = letter;

      // avatar fetch
      const av = await apiPost("/api/avatar", { initData });
      if (av?.ok && av.url) {
        $("avatar").src = av.url;
        $("avatar").style.display = "block";
        $("avatar-fallback").style.display = "none";
      }
    }

    // ---- Render subscriptions ----
    function renderPlans() {
      const host = $("plans");
      host.innerHTML = "";

      SUBSCRIPTIONS.forEach((p, idx) => {
        const plan = document.createElement("div");
        plan.className = "plan";

        const tags = p.price === 0
          ? `<div class="tag">Δωρεάν</div>`
          : `<div class="tag">${p.price.toFixed(0)} €</div>`;

        plan.innerHTML = `
          <div class="name">${p.name}</div>
          <div class="credits">Credits: ${p.credits}</div>

          <div class="tags">${tags}</div>

          <div class="checks">
            ${p.features.map(t => `<div class="check"><div class="dot"></div><div>${t}</div></div>`).join("")}
          </div>

          <button class="btn secondary" data-tools="1">Τι περιλαμβάνει το πακέτο</button>
          <button class="btn ${p.price === 0 ? "disabled" : "primary"}" ${p.price === 0 ? "disabled" : ""} data-buy-sub="1">
            ${p.price === 0 ? "Δωρεάν" : "Αγορά"}
          </button>
        `;

        // tools
        plan.querySelector('[data-tools="1"]').addEventListener("click", () => openModal("modalTools"));

        // buy sub (UI only)
        plan.querySelector('[data-buy-sub="1"]').addEventListener("click", () => {
          if (p.price === 0) return;
          alert("Σύντομα: θα συνδέσουμε αγορά συνδρομής.");
        });

        host.appendChild(plan);
      });
    }

    // ---- Extra credits modal ----
    let selectedPack = EXTRA_PACKS[0];

    function renderExtraPacks() {
      const box = $("extraPacks");
      box.innerHTML = "";
      EXTRA_PACKS.forEach((p) => {
        const b = document.createElement("div");
        b.className = "opt" + (p.credits === selectedPack.credits ? " active" : "");
        b.innerText = p.credits;
        b.addEventListener("click", () => {
          selectedPack = p;
          renderExtraPacks();
          updateTotal();
        });
        box.appendChild(b);
      });
      updateTotal();
    }

    function updateTotal() {
      $("totalPrice").innerText = `${selectedPack.price.toFixed(2)} €`;
    }

    // ---- Modals ----
    function openModal(id) {
      const el = $(id);
      el.style.display = "flex";
    }
    function closeModal(id) {
      const el = $(id);
      el.style.display = "none";
    }

    // ---- Tabs ----
    function setTab(which) {
      const isProfile = which === "profile";
      $("tabProfile").classList.toggle("active", isProfile);
      $("tabPartners").classList.toggle("active", !isProfile);
      $("page-profile").classList.toggle("active", isProfile);
      $("page-partners").classList.toggle("active", !isProfile);
    }

    // Events
    $("tabProfile").addEventListener("click", () => setTab("profile"));
    $("tabPartners").addEventListener("click", () => setTab("partners"));

    $("btnExtraCredits").addEventListener("click", () => openModal("modalExtra"));
    $("closeExtra").addEventListener("click", () => closeModal("modalExtra"));
    $("modalExtra").addEventListener("click", (e) => { if (e.target.id === "modalExtra") closeModal("modalExtra"); });

    $("closeTools").addEventListener("click", () => closeModal("modalTools"));
    $("modalTools").addEventListener("click", (e) => { if (e.target.id === "modalTools") closeModal("modalTools"); });

    $("btnPartnerBenefits").addEventListener("click", () => openModal("modalBenefits"));
    $("closeBenefits").addEventListener("click", () => closeModal("modalBenefits"));
    $("modalBenefits").addEventListener("click", (e) => { if (e.target.id === "modalBenefits") closeModal("modalBenefits"); });

    $("btnBuyExtra").addEventListener("click", () => {
      alert("Σύντομα: θα συνδέσουμε Stripe/PayPal/Crypto για αγορά επιπλέον credits.");
    });

    // Init
    renderPlans();
    renderExtraPacks();
    loadMe();
  </script>
</body>
</html>
