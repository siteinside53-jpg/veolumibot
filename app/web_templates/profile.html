<!doctype html>
<html lang="el">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>AI Marketplace â€“ Î ÏÎ¿Ï†Î¯Î»</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;background:#0b0c10;color:#fff}
    .wrap{max-width:560px;margin:0 auto;padding:16px}
    .card{background:#121421;border:1px solid #232843;border-radius:18px;padding:14px;margin-bottom:12px}
    .row{display:flex;justify-content:space-between;align-items:center;gap:10px}
    .muted{opacity:.75;font-size:13px}
    .title{font-size:18px;font-weight:800}
    .btn{width:100%;padding:12px 14px;border-radius:14px;border:0;cursor:pointer;font-weight:800}
    .btn-primary{background:#7c3aed;color:#fff}
    .btn-ghost{background:#1a1d2d;color:#fff;border:1px solid #2b3150}
    .grid{display:grid;gap:10px}
    .pill{display:inline-block;padding:6px 10px;border-radius:999px;background:#1a1d2d;border:1px solid #2b3150;font-size:12px}
    .tabs{display:flex;gap:10px;margin-bottom:10px}
    .tab{flex:1;text-align:center;padding:10px;border-radius:14px;background:#121421;border:1px solid #232843}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="tabs">
      <div class="tab">ğŸ‘¤ Î¤Î¿ Ï€ÏÎ¿Ï†Î¯Î» Î¼Î¿Ï…</div>
      <div class="tab" style="opacity:.6">ğŸ¤ Î£Ï…Î½ÎµÏÎ³Î±ÏƒÎ¯Î± (soon)</div>
    </div>

    <div class="card">
      <div class="row">
        <div>
          <div class="muted">Î¥Ï€ÏŒÎ»Î¿Î¹Ï€Î¿ credits</div>
          <div class="title">{{ credits }} credits</div>
        </div>
        <div class="pill">Free</div>
      </div>
      <div style="height:10px"></div>
      <div class="muted">Î”Î¹Î¬Î»ÎµÎ¾Îµ Ï€Î±ÎºÎ­Ï„Î¿. Î Î»Î·ÏÏ‰Î¼Î® Î¼Îµ ÎºÎ¬ÏÏ„Î± Î® crypto.</div>
    </div>

    <div class="grid">
      {% for p in packs %}
      <div class="card">
        <div class="row">
          <div>
            <div class="title">{{ p.title }}</div>
            <div class="muted">{{ p.desc }}</div>
          </div>
          <div class="pill">{{ "%.2f"|format(p.amount_eur) }}â‚¬</div>
        </div>
        <div style="height:10px"></div>
        <button class="btn btn-primary" onclick="buyStripe('{{ p.sku }}')">ğŸ’³ Î‘Î³Î¿ÏÎ¬ Î¼Îµ ÎºÎ¬ÏÏ„Î±</button>
        <div style="height:8px"></div>
        <button class="btn btn-ghost" onclick="buyCrypto('{{ p.sku }}')">ğŸª™ Î‘Î³Î¿ÏÎ¬ Î¼Îµ Crypto</button>
      </div>
      {% endfor %}
    </div>
  </div>

<script>
  const tg = window.Telegram.WebApp;
  tg.ready();

  function initData(){ return tg.initData; }

  async function buyStripe(sku){
    const r = await fetch('/api/stripe/checkout', {
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify({ initData: initData(), sku })
    });
    const data = await r.json();
    if(data.url) window.location.href = data.url;
    else alert('Î£Ï†Î¬Î»Î¼Î± checkout');
  }

  async function buyCrypto(sku){
    const r = await fetch('/api/cryptocloud/invoice', {
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify({ initData: initData(), sku })
    });
    const data = await r.json();
    if(data.url) window.location.href = data.url;
    else alert('Î£Ï†Î¬Î»Î¼Î± invoice');
  }
</script>
</body>
</html>
