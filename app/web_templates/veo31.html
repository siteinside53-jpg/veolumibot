<!DOCTYPE html>
<html lang="el">
<head>
  <meta charset="UTF-8">
  <title>Veo 3.1</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    body{margin:0;background:#0b0f16;color:#fff;font-family:sans-serif}
    .box{max-width:420px;margin:auto;padding:16px}
    .card{background:#0f1623;padding:14px;border-radius:14px;margin-bottom:12px}
    label{display:block;margin-bottom:6px;color:#9fb0d0}
    select,textarea,input,button{
      width:100%;padding:10px;border-radius:8px;border:0;background:#141f33;color:white
    }
    textarea{min-height:90px}
    .hidden{display:none}
    button{background:#1f3b66;font-weight:bold;margin-top:10px}
    .price{display:flex;justify-content:space-between;margin-top:10px;color:#9fb0d0}
    .err{color:#ff5c5c;font-size:13px}
  </style>
</head>
<body>
<div class="box">
  <h2>Veo 3.1</h2>

  <div class="card">
    <label>Λειτουργία</label>
    <select id="mode">
      <option value="text">Κείμενο → Βίντεο</option>
      <option value="image">Εικόνα → Βίντεο</option>
      <option value="ref">Αναφορά → Βίντεο</option>
    </select>
  </div>

  <div class="card">
    <label>Prompt</label>
    <textarea id="prompt" placeholder="Περιέγραψε σκηνή / κίνηση / στυλ..."></textarea>
    <div id="errPrompt" class="err hidden">Βάλε prompt (1–5000 χαρακτήρες)</div>
  </div>

  <div class="card">
    <label>Αναλογία Πλευρών</label>
    <select id="ratio">
      <option value="16:9">16:9</option>
      <option value="9:16">9:16</option>
    </select>
  </div>

  <!-- Image → Video -->
  <div class="card hidden" id="imageBox">
    <label>Αρχικό Καρέ (υποχρεωτικό, ≤5MB)</label>
    <input type="file" id="imageStart" accept="image/*">
    <label style="margin-top:10px">Τελικό Καρέ (προαιρετικό, ≤5MB)</label>
    <input type="file" id="imageEnd" accept="image/*">
  </div>

  <!-- Reference → Video -->
  <div class="card hidden" id="refBox">
    <label>1–3 Εικόνες Αναφοράς (≤10MB η καθεμία)</label>
    <input type="file" id="refImages" multiple accept="image/*">
    <div id="errRef" class="err hidden">Χρειάζονται 1–3 εικόνες</div>
  </div>

  <div class="card">
    <div class="price">
      <span>Κόστος</span>
      <b id="price">12 credits</b>
    </div>
    <button id="go">Δημιουργία Βίντεο</button>
  </div>
</div>

<script>
const tg = window.Telegram.WebApp;
tg.expand();

const modeSel = document.getElementById("mode");
const imageBox = document.getElementById("imageBox");
const refBox = document.getElementById("refBox");
const price = document.getElementById("price");

function updateUI(){
  const m = modeSel.value;
  imageBox.classList.add("hidden");
  refBox.classList.add("hidden");

  if(m==="text"){ price.innerText="12 credits"; }
  if(m==="image"){ imageBox.classList.remove("hidden"); price.innerText="12 credits"; }
  if(m==="ref"){ refBox.classList.remove("hidden"); price.innerText="60 credits"; }
}
modeSel.onchange = updateUI;
updateUI();

document.getElementById("go").onclick = async ()=>{
  const prompt = document.getElementById("prompt").value.trim();
  if(!prompt){ document.getElementById("errPrompt").classList.remove("hidden"); return;}
  document.getElementById("errPrompt").classList.add("hidden");

  const fd = new FormData();
  fd.append("tg_init_data", tg.initData || "");
  fd.append("mode", modeSel.value);
  fd.append("prompt", prompt);
  fd.append("aspect_ratio", document.getElementById("ratio").value);

  if(modeSel.value==="image"){
    const s = document.getElementById("imageStart").files[0];
    if(!s){ alert("Βάλε αρχικό καρέ"); return;}
    fd.append("image", s);
    const e = document.getElementById("imageEnd").files[0];
    if(e) fd.append("video", e);
  }

  if(modeSel.value==="ref"){
    const files = document.getElementById("refImages").files;
    if(files.length<1 || files.length>3){ alert("1–3 εικόνες"); return;}
    for(const f of files) fd.append("ref_images", f);
  }

  const r = await fetch("/api/veo31/generate",{method:"POST",body:fd});
  const j = await r.json();
  if(!j.ok) alert("Σφάλμα: "+j.error);
  else tg.showPopup({message:"Στάλθηκε στο Telegram!"});
};
</script>
</body>
</html>
