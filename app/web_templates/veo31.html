<!doctype html>
<html lang="el">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>VeoLumi â€“ Veo 3.1</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>

<style>
  :root{
    --bg:#0b0c12;
    --card:#121422;
    --text:#e9e9f5;
    --muted:#a4a7c0;
    --accent:#7c3aed;
    --accent2:#6d28d9;
    --good:#19c37d;
    --bad:#ef4444;
    --shadow: 0 14px 40px rgba(0,0,0,.55);
    --radius:18px;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Apple Color Emoji","Segoe UI Emoji";
    background:
      radial-gradient(800px 500px at 20% 10%, rgba(124,58,237,.18), transparent 55%),
      radial-gradient(700px 500px at 80% 40%, rgba(124,58,237,.12), transparent 60%),
      var(--bg);
    color:var(--text);
    display:flex;
    justify-content:center;
    padding:18px 14px 28px;
  }
  .wrap{width:min(520px, 100%);margin:0 auto}

  .card{
    background: var(--card);
    border:1px solid rgba(255,255,255,.06);
    border-radius: var(--radius);
    box-shadow: var(--shadow);
    overflow:hidden;
    padding:16px;
  }

  /* Header (NB Pro style) */
  .header{display:flex;justify-content:space-between;align-items:flex-start;gap:12px;margin-bottom:14px}
  .brand{display:flex;align-items:center;gap:10px;min-width:0}
  .logo{
    width:34px;height:34px;border-radius:12px;
    background: linear-gradient(135deg, rgba(124,58,237,.9), rgba(124,58,237,.35));
    display:grid;place-items:center;
    box-shadow:0 10px 20px rgba(124,58,237,.25);
    border:1px solid rgba(255,255,255,.08);
    flex:0 0 auto;
    font-weight:900;
  }
  .title{font-size:18px;font-weight:900;letter-spacing:.2px;line-height:1.15}
  .subtitle{font-size:12px;color:var(--muted);margin-top:2px;font-weight:700;opacity:.95}

  .pill{
    font-size:12px;
    padding:8px 12px;
    border-radius:999px;
    border:1px solid rgba(255,255,255,.10);
    background: rgba(255,255,255,.03);
    color: var(--text);
    white-space:nowrap;
    opacity:.95;
    font-weight:800;
  }
  .pill b{font-weight:900}

  /* Inputs (NB Pro style) */
  label{
    display:block;
    font-weight:800;
    margin:12px 0 6px;
    color:var(--muted);
    text-transform:uppercase;
    letter-spacing:.2px;
    font-size:12px;
    opacity:.95;
  }
  select,textarea,input[type="file"]{
    width:100%;
    border-radius:12px;
    border:1px solid rgba(255,255,255,.08);
    background: rgba(255,255,255,.03);
    color: var(--text);
    padding:12px;
    outline:none;
    font-size:14px;
    font-weight:800;
    line-height:1.35;
  }
  textarea{resize:vertical;min-height:140px;height:140px}

  /* Select arrow (NB Pro style) */
  select{
    appearance:none;
    background-image: linear-gradient(45deg, transparent 50%, rgba(233,233,245,.75) 50%),
                      linear-gradient(135deg, rgba(233,233,245,.75) 50%, transparent 50%);
    background-position: calc(100% - 18px) 55%, calc(100% - 12px) 55%;
    background-size: 6px 6px, 6px 6px;
    background-repeat: no-repeat;
    padding-right: 34px;
  }

  select:focus, textarea:focus, input[type="file"]:focus{
    border-color: rgba(124,58,237,.55);
    box-shadow: 0 0 0 4px rgba(124,58,237,.15);
  }

  input[type="file"]{
    border-style:dashed;
    border-color: rgba(255,255,255,.16);
    background: rgba(255,255,255,.02);
  }

  /* Keep your existing blocks but style them like NB Pro */
  .grid{display:grid;grid-template-columns:1fr 1fr;gap:10px}
  .filebox{
    border:1px dashed rgba(255,255,255,.18);
    background:rgba(255,255,255,.02);
    border-radius:16px;
    padding:12px;
  }

  .btn{
    margin-top:14px;
    width:100%;
    padding:14px 16px;
    border-radius:16px;
    border:0;
    background: linear-gradient(180deg, var(--accent), var(--accent2));
    color:white;
    font-weight:900;
    cursor:pointer;
    box-shadow: 0 12px 22px rgba(124,58,237,.25);
    letter-spacing:.2px;
    font-size:15px;
  }
  .btn:active{transform: translateY(1px)}
  .btn[disabled]{opacity:.6;cursor:not-allowed;box-shadow:none}

  .hint{margin-top:8px;color:var(--muted);font-weight:700;font-size:13px;line-height:1.35}
  .err{color: rgba(239,68,68,.95);font-weight:900;display:none;margin-top:8px;white-space:pre-wrap}
  .ok{color: rgba(25,195,125,.95);font-weight:900;display:none;margin-top:8px;white-space:pre-wrap}

  /* Small spacing polish without changing DOM */
  #imageBlock, #refBlock{margin-top:10px}

  /* ====== ADD (ONLY for upload UI like Nano Banana Pro) ====== */
  #imageFile, #refFiles{display:none;} /* hide native inputs but keep ids */
  .img-grid{display:grid;grid-template-columns: repeat(4, 1fr);gap:10px;margin-top:10px;}
  .img-tile{position:relative;aspect-ratio: 1/1;border-radius:14px;overflow:hidden;background: rgba(255,255,255,.03);border:1px solid rgba(255,255,255,.10);}
  .img-tile img{width:100%;height:100%;object-fit:cover;display:block;}
  .img-remove{position:absolute;top:6px;right:6px;width:22px;height:22px;border-radius:50%;border:0;background: rgba(0,0,0,.65);color:#fff;font-size:16px;line-height:22px;padding:0;cursor:pointer;}
  .img-add{aspect-ratio:1/1;border-radius:14px;border:2px dashed rgba(255,255,255,.18);background:transparent;display:flex;align-items:center;justify-content:center;cursor:pointer;user-select:none;}
  .img-add span{font-size:28px;font-weight:900;color: rgba(255,255,255,.55);}
  .img-add:hover{border-color: rgba(255,255,255,.35);}
  .img-add:hover span{color:#fff;}
  .img-count{margin-top:8px;font-size:13px;color: rgba(255,255,255,.55);font-weight:800;}
  /* ========================================================== */
</style>
</head>

<body>
<div class="wrap">
<div class="card">

  <!-- HEADER (Î¯Î´Î¹Î± Î´Î¿Î¼Î®: .header, #costLabel ÎºÎ»Ï€) -->
  <div class="header">
    <div class="brand">
      <div class="logo" aria-hidden="true">ğŸ¬</div>
      <div>
        <div class="title">Veo 3.1</div>
        <div class="subtitle">Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Î²Î¯Î½Ï„ÎµÎ¿ AI</div>
      </div>
    </div>
    <div class="pill" id="costLabel">ÎšÏŒÏƒÏ„Î¿Ï‚: <b>10</b> credits</div>
  </div>

  <label>Î›ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¯Î±</label>
  <select id="mode">
    <option value="text">ÎšÎµÎ¯Î¼ÎµÎ½Î¿ â†’ Î’Î¯Î½Ï„ÎµÎ¿</option>
    <option value="image">Î•Î¹ÎºÏŒÎ½Î± â†’ Î’Î¯Î½Ï„ÎµÎ¿</option>
    <option value="ref">Î•Î¹ÎºÏŒÎ½ÎµÏ‚ Î‘Î½Î±Ï†Î¿ÏÎ¬Ï‚ â†’ Î’Î¯Î½Ï„ÎµÎ¿</option>
  </select>

  <label>Prompt</label>
  <textarea id="prompt" maxlength="5000" placeholder="Î ÎµÏÎ¹Î­Î³ÏÎ±ÏˆÎµ ÏƒÎºÎ·Î½Î®, ÎºÎ¯Î½Î·ÏƒÎ·, Ï†Ï‰Ï„Î¹ÏƒÎ¼ÏŒ, ÏƒÏ„Ï…Î»..."></textarea>
  <div id="promptErr" class="err">Î¤Î¿ prompt ÎµÎ¯Î½Î±Î¹ Ï…Ï€Î¿Ï‡ÏÎµÏ‰Ï„Î¹ÎºÏŒ.</div>

  <!-- IMAGE (Î¯Î´Î¹Î± ids/Î´Î¿Î¼Î®) -->
  <div id="imageBlock" style="display:none">
    <label>Î‘ÏÏ‡Î¹ÎºÏŒ ÎºÎ±ÏÎ­</label>
    <div class="filebox">
      <input id="imageFile" type="file" accept="image/*"/>
      <div class="hint">1 ÎµÎ¹ÎºÏŒÎ½Î± (JPG/PNG/WebP). Î ÏÎ¿Ï„ÎµÎ¯Î½ÎµÏ„Î±Î¹ â‰¤ 10MB.</div>

      <!-- ADD: grid UI (doesn't change structure, only appends UI) -->
      <div id="img1Grid" class="img-grid"></div>
      <div id="img1Count" class="img-count">0/1</div>
      <!-- END ADD -->
    </div>
  </div>

  <!-- REF (Î¯Î´Î¹Î± ids/Î´Î¿Î¼Î®) -->
  <div id="refBlock" style="display:none">
    <label>Î•Î¹ÎºÏŒÎ½ÎµÏ‚ Î±Î½Î±Ï†Î¿ÏÎ¬Ï‚</label>
    <div class="filebox">
      <input id="refFiles" type="file" multiple accept="image/*"/>
      <div class="hint">1â€“3 ÎµÎ¹ÎºÏŒÎ½ÎµÏ‚. Î ÏÎ¿Ï„ÎµÎ¯Î½ÎµÏ„Î±Î¹ â‰¤ 10MB/ÎµÎ¹ÎºÏŒÎ½Î±.</div>

      <!-- ADD: grid UI (doesn't change structure, only appends UI) -->
      <div id="refGrid" class="img-grid"></div>
      <div id="refCount" class="img-count">0/3</div>
      <!-- END ADD -->
    </div>
    <div id="refErr" class="err"></div>
  </div>

  <div class="grid">
    <div>
      <label>Î‘Î½Î±Î»Î¿Î³Î¯Î±</label>
      <select id="aspect">
        <option value="16:9">16:9</option>
        <option value="9:16">9:16</option>
      </select>
    </div>
  </div>

  <button class="btn" id="btnGenerate">Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î±</button>

  <div class="hint">Î˜Î± ÎµÎ¼Ï†Î±Î½Î¹ÏƒÏ„ÎµÎ¯ popup â€œÏƒÏ„Î¬Î»Î¸Î·ÎºÎµâ€ ÎºÎ±Î¹ Ï„Î¿ Î±Ï€Î¿Ï„Î­Î»ÎµÏƒÎ¼Î± Î¸Î± Î­ÏÎ¸ÎµÎ¹ Î¼Î­ÏƒÎ± ÏƒÏ„Î¿ Telegram chat.</div>

  <div id="okBox" class="ok"></div>
  <div id="errBox" class="err"></div>

</div>
</div>

<script>
const $=id=>document.getElementById(id);
const tg=window.Telegram?.WebApp;
if(tg){tg.expand();tg.ready();}

function cost(m){
  return m==="text"?10:m==="image"?12:60;
}

function sync(){
  const m=$("mode").value;
  $("imageBlock").style.display = m==="image" ? "block" : "none";
  $("refBlock").style.display   = m==="ref"   ? "block" : "none";
  $("costLabel").innerHTML = `ÎšÏŒÏƒÏ„Î¿Ï‚: <b>${cost(m)}</b> credits`;
}

async function generate(){
  $("errBox").style.display="none";
  $("okBox").style.display="none";
  $("promptErr").style.display="none";
  $("refErr").style.display="none";

  const m=$("mode").value;
  const prompt=$("prompt").value.trim();

  if(!prompt){
    $("promptErr").style.display="block";
    return;
  }

  if(m==="image" && !window.__veoImageFile){
    $("errBox").textContent="Î£Ï†Î¬Î»Î¼Î±: Î’Î¬Î»Îµ ÎµÎ¹ÎºÏŒÎ½Î± (Î±ÏÏ‡Î¹ÎºÏŒ ÎºÎ±ÏÎ­).";
    $("errBox").style.display="block";
    return;
  }

  if(m==="ref"){
    const files = Array.isArray(window.__veoRefFiles) ? window.__veoRefFiles : [];
    if(files.length<1 || files.length>3){
      $("refErr").textContent="Î£Ï†Î¬Î»Î¼Î±: Î•Ï€Î¯Î»ÎµÎ¾Îµ 1 Î­Ï‰Ï‚ 3 ÎµÎ¹ÎºÏŒÎ½ÎµÏ‚.";
      $("refErr").style.display="block";
      return;
    }
  }

  const fd=new FormData();
  fd.append("tg_init_data",tg?.initData||"");
  fd.append("mode",m);
  fd.append("prompt",prompt);
  fd.append("aspect_ratio",$("aspect").value);

  if(m==="image"){
    const f = window.__veoImageFile;
    fd.append("image",f,f.name);
  }

  if(m==="ref"){
    (window.__veoRefFiles || []).slice(0,3).forEach(f=>fd.append("ref_images",f,f.name));
  }

  $("btnGenerate").disabled=true;
  $("btnGenerate").textContent="â³ Î‘Ï€Î¿ÏƒÏ„Î¿Î»Î®...";

  tg?.showPopup?.({
    title:"Telegram",
    message:"Î— Î±Î¯Ï„Î·ÏƒÎ· ÏƒÏ„Î¬Î»Î¸Î·ÎºÎµ. Î¤Î¿ Î±Ï€Î¿Ï„Î­Î»ÎµÏƒÎ¼Î± Î¸Î± Î­ÏÎ¸ÎµÎ¹ Î¼Î­ÏƒÎ± ÏƒÏ„Î¿ Telegram.",
    buttons:[{type:"ok",text:"Close"}]
  });

  try{
    const r=await fetch("/api/veo31/generate",{method:"POST",body:fd});
    const d=await r.json().catch(()=>({}));
    if(!r.ok || !d.ok) throw new Error(d.error || d.detail || "Î‘Ï€Î¿Ï„Ï…Ï‡Î¯Î± Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î±Ï‚.");

    $("okBox").textContent="âœ… Î£Ï„Î¬Î»Î¸Î·ÎºÎµ ÏƒÏ„Î¿ Telegram. Î˜Î± Î­ÏÎ¸ÎµÎ¹ Î±Ï€Î¿Ï„Î­Î»ÎµÏƒÎ¼Î± ÏƒÏ„Î¿ chat.";
    $("okBox").style.display="block";
    tg?.close();
  }catch(e){
    $("errBox").textContent="Î£Ï†Î¬Î»Î¼Î±: "+(e?.message||"Î†Î³Î½Ï‰ÏƒÏ„Î¿ ÏƒÏ†Î¬Î»Î¼Î±");
    $("errBox").style.display="block";
    tg?.showAlert?.("Î‘Ï€Î¿Ï„Ï…Ï‡Î¯Î±. " + (e?.message||""));
  }finally{
    $("btnGenerate").disabled=false;
    $("btnGenerate").textContent="Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î±";
  }
}

$("mode").onchange=sync;
$("btnGenerate").onclick=generate;
sync();

/* ====== ADD (ONLY upload behavior like Nano Banana Pro) ====== */
(function setupUploadLikeNB(){
  // ---- image (1 file) ----
  const imgInput = $("imageFile");
  const imgGrid = $("img1Grid");
  const imgCount = $("img1Count");

  let imgFile = null;
  window.__veoImageFile = null;

  function renderImg(){
    if(!imgGrid) return;
    imgGrid.innerHTML = "";

    if(imgFile){
      const tile = document.createElement("div");
      tile.className = "img-tile";

      const im = document.createElement("img");
      const url = URL.createObjectURL(imgFile);
      im.src = url;
      im.onload = () => URL.revokeObjectURL(url);

      const rm = document.createElement("button");
      rm.type = "button";
      rm.className = "img-remove";
      rm.textContent = "Ã—";
      rm.onclick = () => {
        imgFile = null;
        window.__veoImageFile = null;
        renderImg();
      };

      tile.appendChild(im);
      tile.appendChild(rm);
      imgGrid.appendChild(tile);
    } else {
      const add = document.createElement("div");
      add.className = "img-add";
      add.innerHTML = "<span>+</span>";
      add.onclick = () => imgInput?.click();
      imgGrid.appendChild(add);
    }

    if(imgCount) imgCount.textContent = (imgFile ? "1" : "0") + "/1";
  }

  imgInput?.addEventListener("change", () => {
    const f = imgInput.files && imgInput.files[0] ? imgInput.files[0] : null;
    if(!f) return;
    imgFile = f;
    window.__veoImageFile = imgFile;
    imgInput.value = ""; // allow picking same file again
    renderImg();
  });

  renderImg();

  // ---- refs (1-3 files) ----
  const refInput = $("refFiles");
  const refGrid = $("refGrid");
  const refCount = $("refCount");

  let refFiles = [];
  window.__veoRefFiles = refFiles;

  function renderRefs(){
    if(!refGrid) return;
    refGrid.innerHTML = "";

    refFiles.forEach((file, idx) => {
      const tile = document.createElement("div");
      tile.className = "img-tile";

      const im = document.createElement("img");
      const url = URL.createObjectURL(file);
      im.src = url;
      im.onload = () => URL.revokeObjectURL(url);

      const rm = document.createElement("button");
      rm.type = "button";
      rm.className = "img-remove";
      rm.textContent = "Ã—";
      rm.onclick = () => {
        refFiles.splice(idx, 1);
        window.__veoRefFiles = refFiles;
        renderRefs();
      };

      tile.appendChild(im);
      tile.appendChild(rm);
      refGrid.appendChild(tile);
    });

    if(refFiles.length < 3){
      const add = document.createElement("div");
      add.className = "img-add";
      add.innerHTML = "<span>+</span>";
      add.onclick = () => refInput?.click();
      refGrid.appendChild(add);
    }

    if(refCount) refCount.textContent = `${refFiles.length}/3`;
  }

  function addRefs(incoming){
    const arr = Array.from(incoming || []);
    if(!arr.length) return;

    // de-dupe like NB Pro
    const sig = f => `${f.name}|${f.size}|${f.lastModified}`;
    const existing = new Set(refFiles.map(sig));

    for(const f of arr){
      if(refFiles.length >= 3) break;
      const s = sig(f);
      if(existing.has(s)) continue;
      refFiles.push(f);
      existing.add(s);
    }

    window.__veoRefFiles = refFiles;
    renderRefs();
  }

  refInput?.addEventListener("change", () => {
    const selected = Array.from(refInput.files || []);
    addRefs(selected);
    refInput.value = ""; // allow picking same files again
  });

  renderRefs();
})();
/* ============================================================ */
</script>
</body>
</html>
