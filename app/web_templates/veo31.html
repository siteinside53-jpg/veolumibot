<!doctype html>
<html lang="el">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>VeoLumi – Veo 3.1</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>

<style>
:root{
 --bg:#0b0c12;
 --card:#121422;
 --text:#e9e9f5;
 --muted:#a4a7c0;
 --accent:#7c3aed;
 --accent2:#6d28d9;
 --radius:18px;
}
body{
 margin:0;
 font-family:system-ui;
 background:radial-gradient(800px 500px at 20% 10%, rgba(124,58,237,.18), transparent 55%),var(--bg);
 color:var(--text);
 display:flex;
 justify-content:center;
 padding:18px;
}
.wrap{width:min(520px,100%)}
.card{
 background:var(--card);
 border-radius:var(--radius);
 padding:16px;
 border:1px solid rgba(255,255,255,.06);
 box-shadow:0 14px 40px rgba(0,0,0,.55);
}
.header{
 display:flex;
 justify-content:space-between;
 align-items:flex-start;
 gap:10px;
 margin-bottom:14px;
}
.title{font-weight:900;font-size:18px}
.subtitle{font-size:12px;color:var(--muted);font-weight:700}
.badge{
 padding:8px 12px;
 border-radius:999px;
 border:1px solid rgba(255,255,255,.10);
 background:rgba(255,255,255,.04);
 font-weight:900;
 font-size:12px;
}
label{
 display:block;
 margin:12px 0 6px;
 font-size:12px;
 font-weight:900;
 color:var(--muted);
 text-transform:uppercase;
}
textarea,select,input[type=file]{
 width:100%;
 border-radius:12px;
 border:1px solid rgba(255,255,255,.08);
 background:rgba(255,255,255,.03);
 color:white;
 padding:12px;
 font-weight:800;
}
textarea{height:140px}
.grid{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.filebox{
 border:1px dashed rgba(255,255,255,.18);
 border-radius:14px;
 padding:12px;
 background:rgba(255,255,255,.02);
}
.btn{
 margin-top:16px;
 width:100%;
 padding:14px;
 border-radius:16px;
 border:0;
 background:linear-gradient(180deg,var(--accent),var(--accent2));
 font-weight:900;
 color:white;
 cursor:pointer;
}
.btn:disabled{opacity:.6}
.err{display:none;color:#ef4444;font-weight:900;margin-top:10px}
.ok{display:none;color:#22c55e;font-weight:900;margin-top:10px}
.hint{color:var(--muted);font-size:13px;margin-top:6px;font-weight:700}
</style>
</head>

<body>
<div class="wrap">
<div class="card">

<div class="header">
<div>
<div class="title">Veo 3.1</div>
<div class="subtitle">Text → Video · Image → Video · Reference → Video</div>
</div>
<div class="badge" id="costLabel">10 credits</div>
</div>

<label>Mode</label>
<select id="mode">
<option value="text">Text → Video</option>
<option value="image">Image → Video</option>
<option value="ref">Reference → Video</option>
</select>

<label>Prompt</label>
<textarea id="prompt" maxlength="5000" placeholder="Describe motion, scene, lighting, style..."></textarea>
<div id="promptErr" class="err">Το prompt είναι υποχρεωτικό.</div>

<!-- image -->
<div id="imageBlock" style="display:none">
<label>Start Frame</label>
<div class="filebox">
<input id="imageFile" type="file" accept="image/*"/>
<div class="hint">1 εικόνα</div>
</div>
</div>

<!-- ref -->
<div id="refBlock" style="display:none">
<label>Reference Images</label>
<div class="filebox">
<input id="refFiles" type="file" multiple accept="image/*"/>
<div class="hint">1–3 εικόνες</div>
</div>
<div id="refErr" class="err"></div>
</div>

<div class="grid">
<div>
<label>Aspect</label>
<select id="aspect">
<option value="16:9">16:9</option>
<option value="9:16">9:16</option>
</select>
</div>
</div>

<button class="btn" id="btnGenerate">Generate Video</button>

<div id="okBox" class="ok"></div>
<div id="errBox" class="err"></div>

</div>
</div>

<script>
const $=id=>document.getElementById(id);
const tg=window.Telegram?.WebApp;
if(tg){tg.expand();tg.ready();}

function cost(m){
 return m==="text"?10:m==="image"?12:60;
}

function sync(){
const m=$("mode").value;
$("imageBlock").style.display=m==="image"?"block":"none";
$("refBlock").style.display=m==="ref"?"block":"none";
$("costLabel").textContent=cost(m)+" credits";
}

async function generate(){
$("errBox").style.display="none";
$("okBox").style.display="none";
$("promptErr").style.display="none";
$("refErr").style.display="none";

const m=$("mode").value;
const prompt=$("prompt").value.trim();
if(!prompt){$("promptErr").style.display="block";return;}

if(m==="image"&&!$("imageFile").files[0]){
 $("errBox").textContent="Βάλε εικόνα.";
 $("errBox").style.display="block";
 return;
}

if(m==="ref"){
 const f=[...$("refFiles").files];
 if(f.length<1||f.length>3){
  $("refErr").textContent="1 έως 3 εικόνες.";
  $("refErr").style.display="block";
  return;
 }
}

const fd=new FormData();
fd.append("tg_init_data",tg?.initData||"");
fd.append("mode",m);
fd.append("prompt",prompt);
fd.append("aspect_ratio",$("aspect").value);

if(m==="image"){
 const f=$("imageFile").files[0];
 fd.append("image",f,f.name);
}

if(m==="ref"){
 [...$("refFiles").files].slice(0,3)
 .forEach(f=>fd.append("ref_images",f,f.name));
}

$("btnGenerate").disabled=true;
$("btnGenerate").textContent="Sending...";

try{
 const r=await fetch("/api/veo31/generate",{method:"POST",body:fd});
 const d=await r.json();
 if(!r.ok||!d.ok)throw new Error(d.error||"Error");
 $("okBox").textContent="Στάλθηκε. Το αποτέλεσμα θα έρθει στο Telegram.";
 $("okBox").style.display="block";
 tg?.close();
}catch(e){
 $("errBox").textContent="Σφάλμα: "+e.message;
 $("errBox").style.display="block";
}
finally{
 $("btnGenerate").disabled=false;
 $("btnGenerate").textContent="Generate Video";
}
}

$("mode").onchange=sync;
$("btnGenerate").onclick=generate;
sync();
</script>
</body>
</html>
