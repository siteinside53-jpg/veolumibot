<!doctype html>
<html lang="el">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>VeoLumi â€“ Veo 3.1</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>

<style>
:root{
 --bg:#0b0c12;
 --card:#121422;
 --text:#e9e9f5;
 --muted:#a4a7c0;
 --accent:#7c3aed;
 --accent2:#6d28d9;
 --radius:18px;
 --shadow:0 14px 40px rgba(0,0,0,.55);
}
*{box-sizing:border-box}
body{
 margin:0;
 font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto;
 background:
 radial-gradient(800px 500px at 20% 10%, rgba(124,58,237,.18), transparent 55%),
 radial-gradient(700px 500px at 80% 40%, rgba(124,58,237,.12), transparent 60%),
 var(--bg);
 color:var(--text);
 display:flex;
 justify-content:center;
 padding:18px 14px 28px;
}
.wrap{width:min(520px,100%)}
.card{
 background:var(--card);
 border-radius:var(--radius);
 padding:16px;
 border:1px solid rgba(255,255,255,.06);
 box-shadow:var(--shadow);
}

/* header */
.header{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:14px}
.brand{display:flex;gap:10px;align-items:center}
.logo{
 width:34px;height:34px;border-radius:12px;
 background:linear-gradient(135deg, rgba(124,58,237,.9), rgba(124,58,237,.35));
 display:grid;place-items:center;
 box-shadow:0 10px 20px rgba(124,58,237,.25);
}
.title{font-weight:900;font-size:18px}
.subtitle{font-size:12px;color:var(--muted);font-weight:700}
.pill{
 font-size:12px;
 padding:8px 12px;
 border-radius:999px;
 border:1px solid rgba(255,255,255,.10);
 background:rgba(255,255,255,.03);
 font-weight:900;
}

/* inputs */
label{
 display:block;
 margin:12px 0 6px;
 font-size:12px;
 font-weight:900;
 color:var(--muted);
 text-transform:uppercase;
}
textarea,select,input[type=file]{
 width:100%;
 border-radius:12px;
 border:1px solid rgba(255,255,255,.08);
 background:rgba(255,255,255,.03);
 color:white;
 padding:12px;
 font-weight:800;
}
textarea{height:140px}

/* grid */
.grid{display:grid;grid-template-columns:1fr 1fr;gap:10px}

/* upload box */
.filebox{
 border:1px dashed rgba(255,255,255,.18);
 border-radius:14px;
 padding:12px;
 background:rgba(255,255,255,.02);
}

/* button */
.btn{
 margin-top:16px;
 width:100%;
 padding:14px;
 border-radius:16px;
 border:0;
 background:linear-gradient(180deg,var(--accent),var(--accent2));
 font-weight:900;
 color:white;
 cursor:pointer;
 box-shadow:0 12px 22px rgba(124,58,237,.25);
}
.btn:disabled{opacity:.6}

/* feedback */
.err{display:none;color:#ef4444;font-weight:900;margin-top:10px}
.ok{display:none;color:#22c55e;font-weight:900;margin-top:10px}
.hint{color:var(--muted);font-size:13px;margin-top:6px;font-weight:700}
</style>
</head>

<body>
<div class="wrap">
<div class="card">

<!-- HEADER -->
<div class="header">
<div class="brand">
<div class="logo">ğŸ¬</div>
<div>
<div class="title">Veo 3.1</div>
<div class="subtitle">Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Î²Î¯Î½Ï„ÎµÎ¿ AI</div>
</div>
</div>
<div class="pill" id="costLabel">ÎšÏŒÏƒÏ„Î¿Ï‚: 10</div>
</div>

<label>Î›ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¯Î±</label>
<select id="mode">
<option value="text">ÎšÎµÎ¯Î¼ÎµÎ½Î¿ â†’ Î’Î¯Î½Ï„ÎµÎ¿</option>
<option value="image">Î•Î¹ÎºÏŒÎ½Î± â†’ Î’Î¯Î½Ï„ÎµÎ¿</option>
<option value="ref">Î•Î¹ÎºÏŒÎ½ÎµÏ‚ Î‘Î½Î±Ï†Î¿ÏÎ¬Ï‚ â†’ Î’Î¯Î½Ï„ÎµÎ¿</option>
</select>

<label>Prompt</label>
<textarea id="prompt" maxlength="5000" placeholder="Î ÎµÏÎ¹Î­Î³ÏÎ±ÏˆÎµ ÏƒÎºÎ·Î½Î®, ÎºÎ¯Î½Î·ÏƒÎ·, Ï†Ï‰Ï„Î¹ÏƒÎ¼ÏŒ, ÏƒÏ„Ï…Î»..."></textarea>
<div id="promptErr" class="err">Î¤Î¿ prompt ÎµÎ¯Î½Î±Î¹ Ï…Ï€Î¿Ï‡ÏÎµÏ‰Ï„Î¹ÎºÏŒ.</div>

<!-- IMAGE -->
<div id="imageBlock" style="display:none">
<label>Î‘ÏÏ‡Î¹ÎºÏŒ ÎºÎ±ÏÎ­</label>
<div class="filebox">
<input id="imageFile" type="file" accept="image/*"/>
<div class="hint">1 ÎµÎ¹ÎºÏŒÎ½Î±</div>
</div>
</div>

<!-- REF -->
<div id="refBlock" style="display:none">
<label>Î•Î¹ÎºÏŒÎ½ÎµÏ‚ Î±Î½Î±Ï†Î¿ÏÎ¬Ï‚</label>
<div class="filebox">
<input id="refFiles" type="file" multiple accept="image/*"/>
<div class="hint">1â€“3 ÎµÎ¹ÎºÏŒÎ½ÎµÏ‚</div>
</div>
<div id="refErr" class="err"></div>
</div>

<div class="grid">
<div>
<label>Î‘Î½Î±Î»Î¿Î³Î¯Î±</label>
<select id="aspect">
<option value="16:9">16:9</option>
<option value="9:16">9:16</option>
</select>
</div>
</div>

<button class="btn" id="btnGenerate">Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î±</button>

<div id="okBox" class="ok"></div>
<div id="errBox" class="err"></div>

</div>
</div>

<script>
const $=id=>document.getElementById(id);
const tg=window.Telegram?.WebApp;
if(tg){tg.expand();tg.ready();}

function cost(m){
 return m==="text"?10:m==="image"?12:60;
}

function sync(){
const m=$("mode").value;
$("imageBlock").style.display=m==="image"?"block":"none";
$("refBlock").style.display=m==="ref"?"block":"none";
$("costLabel").textContent="ÎšÏŒÏƒÏ„Î¿Ï‚: "+cost(m);
}

async function generate(){

$("errBox").style.display="none";
$("okBox").style.display="none";
$("promptErr").style.display="none";
$("refErr").style.display="none";

const m=$("mode").value;
const prompt=$("prompt").value.trim();

if(!prompt){
 $("promptErr").style.display="block";
 return;
}

if(m==="image"&&!$("imageFile").files[0]){
 $("errBox").textContent="Î’Î¬Î»Îµ ÎµÎ¹ÎºÏŒÎ½Î±.";
 $("errBox").style.display="block";
 return;
}

if(m==="ref"){
 const files=[...$("refFiles").files];
 if(files.length<1||files.length>3){
  $("refErr").textContent="Î•Ï€Î¯Î»ÎµÎ¾Îµ 1 Î­Ï‰Ï‚ 3 ÎµÎ¹ÎºÏŒÎ½ÎµÏ‚.";
  $("refErr").style.display="block";
  return;
 }
}

const fd=new FormData();
fd.append("tg_init_data",tg?.initData||"");
fd.append("mode",m);
fd.append("prompt",prompt);
fd.append("aspect_ratio",$("aspect").value);

if(m==="image"){
 const f=$("imageFile").files[0];
 fd.append("image",f,f.name);
}

if(m==="ref"){
 [...$("refFiles").files].slice(0,3)
 .forEach(f=>fd.append("ref_images",f,f.name));
}

$("btnGenerate").disabled=true;
$("btnGenerate").textContent="â³ Î‘Ï€Î¿ÏƒÏ„Î¿Î»Î®...";

tg?.showPopup?.({
 title:"Telegram",
 message:"Î— Î±Î¯Ï„Î·ÏƒÎ· ÏƒÏ„Î¬Î»Î¸Î·ÎºÎµ. Î¤Î¿ Î±Ï€Î¿Ï„Î­Î»ÎµÏƒÎ¼Î± Î¸Î± Î­ÏÎ¸ÎµÎ¹ ÏƒÏ„Î¿ chat.",
 buttons:[{type:"ok"}]
});

try{
 const r=await fetch("/api/veo31/generate",{method:"POST",body:fd});
 const d=await r.json();
 if(!r.ok||!d.ok)throw new Error(d.error||"Î£Ï†Î¬Î»Î¼Î±");

 $("okBox").textContent="ÎˆÏ„Î¿Î¹Î¼Î¿. Î£Ï„Î¬Î»Î¸Î·ÎºÎµ ÏƒÏ„Î¿ Telegram.";
 $("okBox").style.display="block";
 tg?.close();

}catch(e){
 $("errBox").textContent="Î£Ï†Î¬Î»Î¼Î±: "+e.message;
 $("errBox").style.display="block";
}
finally{
 $("btnGenerate").disabled=false;
 $("btnGenerate").textContent="Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î±";
}
}

$("mode").onchange=sync;
$("btnGenerate").onclick=generate;
sync();
</script>
</body>
</html>
